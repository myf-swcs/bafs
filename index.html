import React, { useState, useEffect, useRef, useMemo } from 'react';
import { initializeApp } from 'firebase/app';
import { 
  getFirestore, 
  doc, 
  setDoc, 
  onSnapshot, 
  collection, 
  query, 
  addDoc, 
  serverTimestamp,
  updateDoc,
  increment
} from 'firebase/firestore';
import { 
  getAuth, 
  signInAnonymously, 
  onAuthStateChanged 
} from 'firebase/auth';
import { 
  Timer, 
  MessageSquare, 
  Users, 
  Trophy, 
  Send, 
  Play, 
  Square, 
  Hash,
  User,
  BookOpen,
  LayoutDashboard,
  Award,
  ChevronRight,
  PieChart as PieChartIcon,
  Book,
  Plus,
  Edit2,
  Check,
  Clock
} from 'lucide-react';

// --- Firebase é…ç½® ---
const firebaseConfig = {
  apiKey: "AIzaSyDBrU-Oy70pCPXTDsis1gC-TAge0RqXrmY",
  authDomain: "timer-9545c.firebaseapp.com",
  databaseURL: "https://timer-9545c-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "timer-9545c",
  storageBucket: "timer-9545c.firebasestorage.app",
  messagingSenderId: "272069871280",
  appId: "1:272069871280:web:c8e8e1d4d06a8542f51d75"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const APP_ID = 'timer-9545c-study-room';

const INITIAL_SUBJECTS = ["ä¸­æ–‡", "è‹±æ–‡", "æ•¸å­¸", "BAFS"];

export default function App() {
  const [view, setView] = useState('study'); 
  const [user, setUser] = useState(null);
  const [userData, setUserData] = useState(null);
  const [room, setRoom] = useState('å…¬ç”¨å¤§å»³');
  const [currentSubject, setCurrentSubject] = useState("ä¸­æ–‡");
  const [inputRoom, setInputRoom] = useState('');
  const [messages, setMessages] = useState([]);
  const [inputMsg, setInputMsg] = useState('');
  const [roomUsers, setRoomUsers] = useState([]);
  const [timerSeconds, setTimerSeconds] = useState(0);
  const [isActive, setIsActive] = useState(false);
  
  const [newSubject, setNewSubject] = useState('');
  const [isEditingName, setIsEditingName] = useState(false);
  const [newName, setNewName] = useState('');

  const chatEndRef = useRef(null);

  // 1. èªè­‰èˆ‡ç”¨æˆ¶æ•¸æ“šåˆå§‹åŒ– (ä¿®æ­£: å¢åŠ éŒ¯èª¤è™•ç†èˆ‡æ›è¼‰æª¢æŸ¥)
  useEffect(() => {
    let isMounted = true;
    signInAnonymously(auth).catch(err => console.error("Auth Error:", err));
    
    const unsubscribe = onAuthStateChanged(auth, (u) => {
      if (u && isMounted) {
        setUser(u);
        const userRef = doc(db, 'artifacts', APP_ID, 'public', 'data', 'onlineUsers', u.uid);
        
        const unsubDoc = onSnapshot(userRef, (docSnap) => {
          if (docSnap.exists()) {
            setUserData(docSnap.data());
          } else {
            setDoc(userRef, {
              uid: u.uid,
              displayName: `å­¸å“¡ ${u.uid.slice(0, 4)}`,
              lastSeen: serverTimestamp(),
              room: room,
              totalStudyTime: 0,
              subjects: {}, 
              customSubjectList: INITIAL_SUBJECTS,
              joinedAt: serverTimestamp()
            });
          }
        });
        return () => unsubDoc();
      }
    });
    return () => { isMounted = false; unsubscribe(); };
  }, []);

  // 2. æˆ¿é–“ä½ç½®æ›´æ–° (ä¿®æ­£: å¢åŠ  user æª¢æŸ¥ä¿è­·)
  useEffect(() => {
    if (user) {
      const userRef = doc(db, 'artifacts', APP_ID, 'public', 'data', 'onlineUsers', user.uid);
      updateDoc(userRef, { room: room }).catch(e => console.log("Update room error:", e));
    }
  }, [room, user]);

  // 3. èŠå¤©è¨Šæ¯è¨‚é–±
  useEffect(() => {
    if (!user) return;
    const q = query(collection(db, 'artifacts', APP_ID, 'public', 'data', `chats_${room}`));
    const unsubscribe = onSnapshot(q, (snapshot) => {
      const msgs = snapshot.docs
        .map(doc => ({ id: doc.id, ...doc.data() }))
        .sort((a, b) => (a.timestamp?.seconds || 0) - (b.timestamp?.seconds || 0));
      setMessages(msgs.slice(-30));
      setTimeout(() => chatEndRef.current?.scrollIntoView({ behavior: 'smooth' }), 100);
    }, (error) => console.log("Chat sync error:", error));
    return () => unsubscribe();
  }, [user, room]);

  // 4. æ’è¡Œæ¦œè¨‚é–±
  useEffect(() => {
    if (!user) return;
    const q = query(collection(db, 'artifacts', APP_ID, 'public', 'data', 'onlineUsers'));
    const unsubscribe = onSnapshot(q, (snapshot) => {
      const users = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      setRoomUsers(users.filter(u => u.room === room));
    });
    return () => unsubscribe();
  }, [user, room]);

  // 5. è¨ˆæ™‚å™¨é‚è¼¯
  useEffect(() => {
    let interval = null;
    if (isActive) {
      interval = setInterval(() => setTimerSeconds(prev => prev + 1), 1000);
    } else {
      setTimerSeconds(0);
    }
    return () => clearInterval(interval);
  }, [isActive]);

  // æ¯ 10 ç§’å°‡æ•¸æ“šåŒæ­¥åˆ° Firestore (ä¿®æ­£: å¢åŠ  isActive æª¢æŸ¥)
  useEffect(() => {
    if (isActive && timerSeconds > 0 && timerSeconds % 10 === 0 && user) {
      const userRef = doc(db, 'artifacts', APP_ID, 'public', 'data', 'onlineUsers', user.uid);
      updateDoc(userRef, {
        totalStudyTime: increment(10),
        lastSeen: serverTimestamp(),
        [`subjects.${currentSubject}`]: increment(10)
      }).catch(e => console.log("Study sync error:", e));
    }
  }, [timerSeconds, isActive, user, currentSubject]);

  const handleAddSubject = () => {
    if (!newSubject.trim() || !user || !userData) return;
    if (userData.customSubjectList?.includes(newSubject.trim())) return;
    
    const userRef = doc(db, 'artifacts', APP_ID, 'public', 'data', 'onlineUsers', user.uid);
    updateDoc(userRef, {
      customSubjectList: [...(userData.customSubjectList || []), newSubject.trim()]
    });
    setNewSubject('');
  };

  const handleUpdateName = () => {
    if (!newName.trim() || !user) return;
    const userRef = doc(db, 'artifacts', APP_ID, 'public', 'data', 'onlineUsers', user.uid);
    updateDoc(userRef, { displayName: newName.trim() });
    setIsEditingName(false);
  };

  const handleSendMessage = async (e) => {
    e.preventDefault();
    if (!inputMsg.trim() || !user) return;
    await addDoc(collection(db, 'artifacts', APP_ID, 'public', 'data', `chats_${room}`), {
      text: inputMsg,
      uid: user.uid,
      timestamp: serverTimestamp(),
      sender: userData?.displayName || `ç”¨æˆ¶_${user.uid.slice(0, 4)}`
    });
    setInputMsg('');
  };

  const formatToHours = (s) => {
    return (s / 3600).toFixed(1);
  };

  const formatTime = (s) => {
    const h = Math.floor(s / 3600);
    const m = Math.floor((s % 3600) / 60);
    const sec = s % 60;
    return h > 0 ? `${h}h ${m}m ${sec}s` : `${m.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
  };

  const subjectList = userData?.customSubjectList || INITIAL_SUBJECTS;

  const pieChartData = useMemo(() => {
    if (!userData?.subjects || !userData?.totalStudyTime) return [];
    const colors = ['#6366f1', '#f59e0b', '#10b981', '#ef4444', '#8b5cf6', '#ec4899', '#06b6d4'];
    let cumulativePercent = 0;
    
    const validSubjects = Object.entries(userData.subjects).filter(([_, sec]) => sec > 0);
    
    // å¦‚æœåªæœ‰ä¸€å€‹ç§‘ç›®ï¼Œç‰¹åˆ¥è™•ç†ç‚ºå®Œæ•´çš„åœ“
    if (validSubjects.length === 1) {
      const [name, sec] = validSubjects[0];
      return [{
        name,
        seconds: sec,
        percent: 100,
        path: "M 1 0 A 1 1 0 1 1 1 -0.0001 L 0 0 Z",
        color: colors[0]
      }];
    }

    return validSubjects.map(([name, sec], i) => {
        const percent = sec / userData.totalStudyTime;
        const startX = Math.cos(2 * Math.PI * cumulativePercent);
        const startY = Math.sin(2 * Math.PI * cumulativePercent);
        cumulativePercent += percent;
        const endX = Math.cos(2 * Math.PI * cumulativePercent);
        const endY = Math.sin(2 * Math.PI * cumulativePercent);
        const largeArcFlag = percent > 0.5 ? 1 : 0;

        return {
          name,
          seconds: sec,
          percent: Math.round(percent * 100),
          path: `M 0 0 L ${startX} ${startY} A 1 1 0 ${largeArcFlag} 1 ${endX} ${endY} Z`,
          color: colors[i % colors.length]
        };
      });
  }, [userData]);

  const levelInfo = useMemo(() => {
    const totalMinutes = Math.floor((userData?.totalStudyTime || 0) / 60);
    if (totalMinutes < 60) return { level: 'åˆå­¸è€…', icon: 'ğŸŒ±', next: 60 - totalMinutes };
    if (totalMinutes < 300) return { level: 'é€²éšå­¸è€…', icon: 'ğŸ“˜', next: 300 - totalMinutes };
    return { level: 'æº«ç¿’æˆ°ç¥', icon: 'ğŸ‘‘', next: 0 };
  }, [userData]);

  return (
    <div className="min-h-screen bg-slate-50 text-slate-900 font-sans">
      <nav className="bg-white border-b border-slate-200 sticky top-0 z-50 px-4">
        <div className="max-w-6xl mx-auto flex items-center justify-between h-16">
          <div className="flex items-center gap-2 font-black text-xl text-indigo-600 cursor-pointer" onClick={() => setView('study')}>
            <BookOpen size={28} />
            <span>V-Study</span>
          </div>
          <div className="flex bg-slate-100 p-1 rounded-xl">
            <button onClick={() => setView('study')} className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-all ${view === 'study' ? 'bg-white shadow-sm text-indigo-600' : 'text-slate-500'}`}><LayoutDashboard size={18} />æº«ç¿’å®¤</button>
            <button onClick={() => setView('profile')} className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-all ${view === 'profile' ? 'bg-white shadow-sm text-indigo-600' : 'text-slate-500'}`}><User size={18} />å€‹äººæª”æ¡ˆ</button>
          </div>
        </div>
      </nav>

      <main className="max-w-6xl mx-auto p-4 md:p-8">
        {view === 'study' ? (
          <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
            <div className="lg:col-span-3 space-y-6">
              <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                <div className="flex items-center gap-2 mb-4 text-indigo-600 font-bold"><Hash size={18} /><span>æˆ¿é–“</span></div>
                <h2 className="text-xl font-bold mb-4 truncate">{room}</h2>
                <div className="flex gap-2">
                  <input type="text" placeholder="æˆ¿è™Ÿ..." className="w-full px-3 py-2 bg-slate-50 rounded-lg text-sm border border-slate-200 outline-none focus:ring-2 ring-indigo-500" value={inputRoom} onChange={(e) => setInputRoom(e.target.value)} />
                  <button onClick={() => { if(inputRoom) setRoom(inputRoom); setInputRoom(''); }} className="bg-indigo-600 text-white p-2 rounded-lg hover:bg-indigo-700 transition-colors"><ChevronRight size={18} /></button>
                </div>
              </div>

              <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                <div className="flex items-center gap-2 mb-4 text-amber-500 font-bold"><Trophy size={18} /><span>æˆ¿é–“æ’è¡Œæ¦œ</span></div>
                <div className="space-y-3">
                  {roomUsers.sort((a,b) => (b.totalStudyTime||0)-(a.totalStudyTime||0)).slice(0,5).map((u, idx) => (
                    <div key={u.uid} className="flex items-center justify-between p-2 bg-slate-50 rounded-xl text-xs font-semibold">
                      <div className="flex items-center gap-2">
                        <span className={`w-5 h-5 flex items-center justify-center rounded-full text-[10px] text-white ${idx === 0 ? 'bg-yellow-400' : 'bg-slate-300'}`}>{idx + 1}</span>
                        <span className="truncate max-w-[80px]">{u.displayName || 'åŒ¿å'}</span>
                      </div>
                      <span className="text-indigo-600">{(u.totalStudyTime||0) >= 3600 ? `${formatToHours(u.totalStudyTime)}h` : `${Math.floor((u.totalStudyTime || 0) / 60)}m`}</span>
                    </div>
                  ))}
                  {roomUsers.length === 0 && <div className="text-[10px] text-slate-400 text-center py-2">ç›®å‰æ²’æœ‰äººåœ¨é€™</div>}
                </div>
              </div>
            </div>

            <div className="lg:col-span-6 space-y-6">
              <div className="bg-white rounded-[2.5rem] p-8 shadow-sm border border-slate-200 flex flex-col items-center">
                <div className="mb-6 w-full space-y-4">
                  <div className="flex flex-wrap justify-center gap-2">
                    {subjectList.map(sub => (
                      <button 
                        key={sub} 
                        disabled={isActive}
                        onClick={() => setCurrentSubject(sub)}
                        className={`px-3 py-1.5 rounded-full text-xs font-bold border transition-all ${currentSubject === sub ? 'bg-indigo-600 text-white border-indigo-600 shadow-md' : 'bg-white text-slate-500 border-slate-200 hover:border-indigo-300'}`}
                      >
                        {sub}
                      </button>
                    ))}
                    <div className="flex items-center gap-1 bg-slate-50 rounded-full px-2 py-1 border border-dashed border-slate-300">
                      <input 
                        type="text" 
                        placeholder="æ–°èª²ç›®..." 
                        className="bg-transparent border-none text-[10px] outline-none w-14"
                        value={newSubject}
                        onChange={(e) => setNewSubject(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && handleAddSubject()}
                      />
                      <button onClick={handleAddSubject} className="text-indigo-600 hover:scale-110 transition-transform"><Plus size={14} /></button>
                    </div>
                  </div>
                </div>

                <div className="bg-indigo-50 p-6 rounded-full mb-6 relative">
                  <Timer size={40} className={`text-indigo-600 ${isActive ? 'animate-pulse' : ''}`} />
                  {isActive && <div className="absolute inset-0 rounded-full border-2 border-indigo-200 animate-ping"></div>}
                </div>
                <p className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">æ­£åœ¨å°ˆæ³¨æ–¼ï¼š{currentSubject}</p>
                <div className="text-7xl font-mono font-black text-slate-800 mb-8 tracking-tighter transition-all">
                  {isActive ? formatTime(timerSeconds) : "00:00"}
                </div>
                
                <button 
                  onClick={() => setIsActive(!isActive)}
                  className={`w-full max-w-xs flex items-center justify-center gap-2 py-4 rounded-2xl font-bold shadow-lg transition-all active:scale-95 ${isActive ? 'bg-rose-500 text-white shadow-rose-100 hover:bg-rose-600' : 'bg-indigo-600 text-white shadow-indigo-100 hover:bg-indigo-700'}`}
                >
                  {isActive ? <Square size={20} fill="currentColor" /> : <Play size={20} fill="currentColor" />}
                  {isActive ? 'åœæ­¢ä¸¦çµç®—' : 'é–‹å§‹å°ˆæ³¨'}
                </button>
              </div>
              
              <div className="grid grid-cols-2 gap-4 text-center">
                <div className="bg-white p-5 rounded-2xl border border-slate-200">
                  <p className="text-[10px] uppercase font-bold text-slate-400 mb-1">æˆ¿é–“åœ¨ç·š</p>
                  <p className="text-xl font-bold">{roomUsers.length}</p>
                </div>
                <div className="bg-white p-5 rounded-2xl border border-slate-200">
                  <p className="text-[10px] uppercase font-bold text-slate-400 mb-1">æœ¬ç§‘ç´¯è¨ˆ</p>
                  <p className="text-xl font-bold text-indigo-600">{(userData?.subjects?.[currentSubject] || 0) >= 3600 ? `${formatToHours(userData?.subjects?.[currentSubject])}h` : `${Math.floor((userData?.subjects?.[currentSubject] || 0) / 60)}m`}</p>
                </div>
              </div>
            </div>

            <div className="lg:col-span-3 flex flex-col h-[500px] lg:h-auto bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
              <div className="p-4 border-b border-slate-100 bg-slate-50/50 font-bold text-slate-700 text-sm">å³æ™‚è¨è«–å€</div>
              <div className="flex-1 overflow-y-auto p-4 space-y-4">
                {messages.map((m) => (
                  <div key={m.id} className={`flex flex-col ${m.uid === user?.uid ? 'items-end' : 'items-start'}`}>
                    <span className="text-[9px] text-slate-400 mb-0.5">{m.sender}</span>
                    <div className={`max-w-[90%] px-3 py-2 rounded-2xl text-xs break-words shadow-sm ${m.uid === user?.uid ? 'bg-indigo-600 text-white' : 'bg-slate-100'}`}>{m.text}</div>
                  </div>
                ))}
                <div ref={chatEndRef} />
              </div>
              <form onSubmit={handleSendMessage} className="p-4 border-t flex gap-2">
                <input type="text" placeholder="è¼¸å…¥è¨Šæ¯..." className="flex-1 px-3 py-2 bg-slate-100 rounded-xl text-xs outline-none focus:ring-1 ring-indigo-300" value={inputMsg} onChange={(e) => setInputMsg(e.target.value)} />
                <button type="submit" className="p-2 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-all"><Send size={16} /></button>
              </form>
            </div>
          </div>
        ) : (
          /* å€‹äººæª”æ¡ˆ */
          <div className="max-w-2xl mx-auto space-y-8 animate-in fade-in duration-500">
            <div className="bg-white rounded-3xl p-8 shadow-sm border border-slate-200 flex flex-col items-center relative overflow-hidden">
              <div className="absolute top-0 left-0 w-full h-24 bg-gradient-to-r from-indigo-500 to-purple-500 opacity-10"></div>
              <div className="w-24 h-24 bg-white rounded-full flex items-center justify-center text-4xl mb-4 border-4 border-indigo-50 shadow-xl z-10">{levelInfo.icon}</div>
              
              <div className="flex items-center gap-2 mb-2 z-10">
                {isEditingName ? (
                  <div className="flex items-center gap-1 border-b-2 border-indigo-500 pb-1">
                    <input 
                      type="text" 
                      className="text-xl font-black text-center outline-none bg-transparent"
                      value={newName}
                      onChange={(e) => setNewName(e.target.value)}
                      autoFocus
                    />
                    <button onClick={handleUpdateName} className="text-emerald-500 hover:scale-110"><Check size={20} /></button>
                  </div>
                ) : (
                  <>
                    <h2 className="text-2xl font-black text-slate-800">{userData?.displayName}</h2>
                    <button onClick={() => setIsEditingName(true)} className="text-slate-400 hover:text-indigo-500 transition-colors"><Edit2 size={16} /></button>
                  </>
                )}
              </div>
              
              <p className="text-indigo-600 font-bold text-sm tracking-wide z-10">{levelInfo.level}</p>
              
              <div className="mt-8 w-full bg-slate-100 h-2 rounded-full overflow-hidden z-10">
                <div className="bg-indigo-600 h-full transition-all duration-1000" style={{ width: `${Math.min(100, ((userData?.totalStudyTime || 0) / ((userData?.totalStudyTime || 0) + (levelInfo.next * 60))) * 100)}%` }}></div>
              </div>
              <p className="text-[10px] text-slate-400 mt-3 font-bold uppercase tracking-tighter z-10">
                {levelInfo.next > 0 ? `è·é›¢å‡ç´šé‚„éœ€å°ˆæ³¨ ${levelInfo.next} åˆ†é˜` : 'æœ€é«˜ç­‰ç´šé”æˆ'}
              </p>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div className="bg-indigo-600 p-6 rounded-3xl text-white shadow-xl shadow-indigo-100">
                <div className="bg-white/20 w-10 h-10 rounded-xl flex items-center justify-center mb-3"><Clock size={20}/></div>
                <p className="text-indigo-100 text-[10px] font-bold uppercase tracking-widest mb-1">ç´¯ç©ç¸½æ™‚æ•¸</p>
                <p className="text-3xl font-black">{formatToHours(userData?.totalStudyTime || 0)} <span className="text-sm font-normal">h</span></p>
              </div>
              <div className="bg-white p-6 rounded-3xl border border-slate-200">
                <p className="text-slate-400 text-[10px] font-bold uppercase mb-1 tracking-widest">ç¸½å°ˆæ³¨ç§’æ•¸</p>
                <p className="text-xl font-black font-mono text-slate-800">{userData?.totalStudyTime || 0}</p>
              </div>
              <div className="bg-white p-6 rounded-3xl border border-slate-200">
                <p className="text-slate-400 text-[10px] font-bold uppercase mb-1 tracking-widest">å·²è§£é–å­¸ç§‘</p>
                <p className="text-xl font-bold text-indigo-500">{subjectList.length} <span className="text-sm font-normal text-slate-400">ç§‘</span></p>
              </div>
            </div>

            <div className="bg-white rounded-3xl p-8 shadow-sm border border-slate-200">
              <div className="flex items-center gap-2 mb-8 font-bold text-slate-800 border-b pb-4">
                <PieChartIcon size={20} className="text-indigo-500" />
                <span>å„ç§‘å­¸æ™‚åœ“é¤…åœ– (å°æ™‚)</span>
              </div>
              
              <div className="flex flex-col md:flex-row items-center justify-around gap-12">
                {pieChartData.length > 0 ? (
                  <div className="relative w-48 h-48 transform -rotate-90">
                    <svg viewBox="-1 -1 2 2" className="w-full h-full overflow-visible">
                      {pieChartData.map((slice, i) => (
                        <path 
                          key={i} 
                          d={slice.path} 
                          fill={slice.color} 
                          className="hover:opacity-80 transition-opacity cursor-pointer"
                        />
                      ))}
                    </svg>
                  </div>
                ) : (
                  <div className="w-48 h-48 bg-slate-50 rounded-full border border-dashed border-slate-200 flex items-center justify-center text-slate-300 text-[10px] text-center p-6">
                    é–‹å§‹æº«ç¿’ä¾†<br/>ç”Ÿæˆçµ±è¨ˆåœ–è¡¨
                  </div>
                )}

                <div className="flex-1 space-y-4 w-full">
                  {pieChartData.map((slice, i) => (
                    <div key={i} className="flex flex-col gap-1.5">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-2">
                          <div className="w-2.5 h-2.5 rounded-full" style={{ backgroundColor: slice.color }}></div>
                          <span className="text-sm font-bold text-slate-700">{slice.name}</span>
                        </div>
                        <span className="text-xs font-black text-indigo-600">{formatToHours(slice.seconds)}h ({slice.percent}%)</span>
                      </div>
                      <div className="w-full bg-slate-100 h-1.5 rounded-full overflow-hidden">
                         <div className="h-full rounded-full transition-all duration-700" style={{ backgroundColor: slice.color, width: `${slice.percent}%` }}></div>
                      </div>
                    </div>
                  ))}
                  {pieChartData.length === 0 && <p className="text-xs text-slate-400 italic text-center">å°šæœªæœ‰å°ˆæ³¨ç´€éŒ„</p>}
                </div>
              </div>
            </div>

            <button onClick={() => setView('study')} className="w-full py-4 text-indigo-600 font-bold hover:bg-indigo-50 rounded-2xl transition-colors flex items-center justify-center gap-2">
              è¿”å›æº«ç¿’å®¤ <ChevronRight size={18} />
            </button>
          </div>
        )}
      </main>
    </div>
  );
}
